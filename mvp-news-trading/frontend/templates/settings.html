{% extends "base.html" %}

{% block title %}Settings - MVP News Trading{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-shield-check"></i> Risk Management Settings</h5>
            </div>
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Max Trades Per Day</label>
                        <input type="number" class="form-control" value="3" min="1" max="10">
                        <small class="text-muted">Maximum number of trades allowed per day</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Max Risk Per Trade (%)</label>
                        <input type="number" class="form-control" value="2" min="0.5" max="5" step="0.5">
                        <small class="text-muted">Maximum portfolio percentage to risk per trade</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Max Daily Loss (%)</label>
                        <input type="number" class="form-control" value="5" min="1" max="10">
                        <small class="text-muted">Stop trading if daily loss exceeds this percentage</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Confidence Threshold (%)</label>
                        <input type="number" class="form-control" value="70" min="50" max="95">
                        <small class="text-muted">Minimum confidence required to execute trades</small>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="saveRiskSettings()">
                        <i class="bi bi-save"></i> Save Risk Settings
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-clock"></i> Trading Schedule</h5>
            </div>
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Scout Interval (minutes)</label>
                        <input type="number" class="form-control" value="30" min="5" max="120">
                        <small class="text-muted">How often to scan for news</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Market Open (CET)</label>
                        <input type="time" class="form-control" value="09:00">
                        <small class="text-muted">Start trading at this time</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Market Close (CET)</label>
                        <input type="time" class="form-control" value="17:30">
                        <small class="text-muted">Stop trading at this time</small>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="weekends" disabled>
                            <label class="form-check-label" for="weekends">
                                Trade on weekends
                            </label>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="saveScheduleSettings()">
                        <i class="bi bi-save"></i> Save Schedule
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-bell"></i> Notifications</h5>
            </div>
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="email-notifications">
                            <label class="form-check-label" for="email-notifications">
                                Email Notifications
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="telegram-notifications" checked>
                            <label class="form-check-label" for="telegram-notifications">
                                Telegram Notifications
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Telegram Chat ID</label>
                        <input type="text" class="form-control" placeholder="Enter your Telegram chat ID">
                        <small class="text-muted">Get this from @userinfobot on Telegram</small>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="saveNotificationSettings()">
                        <i class="bi bi-save"></i> Save Notifications
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-key"></i> API Configuration</h5>
            </div>
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Alpaca Status</label>
                        <div class="input-group">
                            <input type="text" class="form-control" value="Paper Trading Active" readonly>
                            <button class="btn btn-success" type="button">
                                <i class="bi bi-check-circle"></i> Connected
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Gemini AI Status</label>
                        <div class="input-group">
                            <input type="text" class="form-control" value="API Key Configured" readonly>
                            <button class="btn btn-success" type="button">
                                <i class="bi bi-check-circle"></i> Active
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Webhook Secret</label>
                        <div class="input-group">
                            <input type="password" class="form-control" value="********" readonly>
                            <button class="btn btn-outline-secondary" type="button" onclick="regenerateWebhookSecret()">
                                <i class="bi bi-arrow-clockwise"></i> Regenerate
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-danger" onclick="testConnections()">
                        <i class="bi bi-plug"></i> Test All Connections
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Danger Zone</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <button class="btn btn-warning w-100" onclick="pauseTrading()">
                            <i class="bi bi-pause-circle"></i> Pause All Trading
                        </button>
                        <small class="text-muted d-block mt-1">Temporarily stop all trading activity</small>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-danger w-100" onclick="closeAllPositions()">
                            <i class="bi bi-x-octagon"></i> Close All Positions
                        </button>
                        <small class="text-muted d-block mt-1">Emergency close all open positions</small>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-dark w-100" onclick="resetSystem()">
                            <i class="bi bi-arrow-counterclockwise"></i> Reset System
                        </button>
                        <small class="text-muted d-block mt-1">Clear all data and start fresh</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function saveRiskSettings() {
        // In a real app, send to backend API
        alert('Risk settings saved successfully!');
    }
    
    function saveScheduleSettings() {
        alert('Schedule settings saved successfully!');
    }
    
    function saveNotificationSettings() {
        alert('Notification settings saved successfully!');
    }
    
    function testConnections() {
        alert('Testing all API connections...\nAlpaca: ✓ Connected\nGemini: ✓ Connected\nDatabase: ✓ Connected');
    }
    
    function regenerateWebhookSecret() {
        if (confirm('Are you sure you want to regenerate the webhook secret?')) {
            alert('New webhook secret generated!');
        }
    }
    
    function pauseTrading() {
        if (confirm('Pause all trading activity?')) {
            alert('Trading paused. You can resume from this page.');
        }
    }
    
    function closeAllPositions() {
        if (confirm('WARNING: This will close all open positions at market price. Continue?')) {
            if (confirm('Are you absolutely sure? This cannot be undone.')) {
                alert('Closing all positions...');
            }
        }
    }
    
    function resetSystem() {
        if (confirm('WARNING: This will reset the entire system and clear all data. Continue?')) {
            if (confirm('Are you absolutely sure? This cannot be undone.')) {
                alert('System reset initiated...');
            }
        }
    }
</script>
{% endblock %}