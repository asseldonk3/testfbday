<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trades - MVP News Trading</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        body {
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        main {
            flex: 1;
        }

        .navbar-dark {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.3rem;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        }

        .table {
            background-color: white;
        }

        .table thead th {
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }

        .profit { color: #198754; font-weight: 600; }
        .loss { color: #dc3545; font-weight: 600; }

        .status-open { background-color: #0dcaf0; }
        .status-closed { background-color: #6c757d; }
        .status-pending { background-color: #ffc107; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <i class="bi bi-graph-up"></i> MVP News Trading
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="trades.html">
                            <i class="bi bi-currency-exchange"></i> Trades
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="signals.html">
                            <i class="bi bi-lightning"></i> Signals
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="watchlist.html">
                            <i class="bi bi-eye"></i> Watchlist
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="settings.html">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                    </li>
                </ul>
                <div class="navbar-text">
                    <span class="badge bg-success me-2" id="connection-status">
                        <i class="bi bi-circle-fill"></i> Connected
                    </span>
                    <span class="text-light" id="current-time"></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container-fluid py-3">
        <!-- Stats Row -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Total Trades</h6>
                        <h3 id="total-trades">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Win Rate</h6>
                        <h3 id="win-rate" class="text-primary">0%</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Total P&L</h6>
                        <h3 id="total-pnl" class="text-success">$0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">Average Trade</h6>
                        <h3 id="avg-trade">$0</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trades Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-list-ul"></i> Trade History
                            <button class="btn btn-sm btn-primary float-end" onclick="exportTrades()">
                                <i class="bi bi-download"></i> Export CSV
                            </button>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date/Time</th>
                                        <th>Symbol</th>
                                        <th>Side</th>
                                        <th>Quantity</th>
                                        <th>Entry Price</th>
                                        <th>Exit Price</th>
                                        <th>P&L</th>
                                        <th>P&L %</th>
                                        <th>Status</th>
                                        <th>Strategy</th>
                                    </tr>
                                </thead>
                                <tbody id="trades-tbody">
                                    <tr>
                                        <td colspan="10" class="text-center text-muted">No trades yet</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Open Positions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-eye"></i> Open Positions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Quantity</th>
                                        <th>Entry Price</th>
                                        <th>Current Price</th>
                                        <th>Unrealized P&L</th>
                                        <th>Stop Loss</th>
                                        <th>Take Profit</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="positions-tbody">
                                    <tr>
                                        <td colspan="8" class="text-center text-muted">No open positions</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer mt-auto py-3 bg-light">
        <div class="container text-center">
            <span class="text-muted">MVP News Trading System v1.0 | Paper Trading Mode</span>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Update current time
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Mock trade data
        const mockTrades = [
            {
                date: new Date().toISOString(),
                symbol: 'AAPL',
                side: 'BUY',
                quantity: 100,
                entryPrice: 150.25,
                exitPrice: 152.50,
                pnl: 225,
                pnlPercent: 1.5,
                status: 'closed',
                strategy: 'News-Based'
            }
        ];

        // Load trades
        function loadTrades() {
            const tbody = document.getElementById('trades-tbody');
            
            // Check for saved trades
            const savedTrades = localStorage.getItem('trades');
            const trades = savedTrades ? JSON.parse(savedTrades) : [];
            
            if (trades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="text-center text-muted">No trades yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = trades.map(trade => `
                <tr>
                    <td>${new Date(trade.date).toLocaleString()}</td>
                    <td><strong>${trade.symbol}</strong></td>
                    <td>
                        <span class="badge bg-${trade.side === 'BUY' ? 'success' : 'danger'}">
                            ${trade.side}
                        </span>
                    </td>
                    <td>${trade.quantity}</td>
                    <td>$${trade.entryPrice.toFixed(2)}</td>
                    <td>${trade.exitPrice ? '$' + trade.exitPrice.toFixed(2) : '-'}</td>
                    <td class="${trade.pnl >= 0 ? 'profit' : 'loss'}">
                        ${trade.pnl >= 0 ? '+' : ''}$${trade.pnl.toFixed(2)}
                    </td>
                    <td class="${trade.pnlPercent >= 0 ? 'profit' : 'loss'}">
                        ${trade.pnlPercent >= 0 ? '+' : ''}${trade.pnlPercent.toFixed(2)}%
                    </td>
                    <td>
                        <span class="badge status-${trade.status}">
                            ${trade.status.toUpperCase()}
                        </span>
                    </td>
                    <td>${trade.strategy}</td>
                </tr>
            `).join('');
            
            // Update stats
            updateStats(trades);
        }

        // Update statistics
        function updateStats(trades) {
            const totalTrades = trades.length;
            const wins = trades.filter(t => t.pnl > 0).length;
            const winRate = totalTrades > 0 ? (wins / totalTrades * 100).toFixed(1) : 0;
            const totalPnL = trades.reduce((sum, t) => sum + (t.pnl || 0), 0);
            const avgTrade = totalTrades > 0 ? totalPnL / totalTrades : 0;
            
            document.getElementById('total-trades').textContent = totalTrades;
            document.getElementById('win-rate').textContent = `${winRate}%`;
            document.getElementById('total-pnl').textContent = `${totalPnL >= 0 ? '+' : ''}$${totalPnL.toFixed(2)}`;
            document.getElementById('total-pnl').className = totalPnL >= 0 ? 'text-success' : 'text-danger';
            document.getElementById('avg-trade').textContent = `${avgTrade >= 0 ? '+' : ''}$${avgTrade.toFixed(2)}`;
        }

        // Export trades to CSV
        function exportTrades() {
            const trades = localStorage.getItem('trades');
            if (!trades) {
                alert('No trades to export');
                return;
            }
            
            const data = JSON.parse(trades);
            const csv = [
                ['Date', 'Symbol', 'Side', 'Quantity', 'Entry', 'Exit', 'P&L', 'P&L%', 'Status', 'Strategy'],
                ...data.map(t => [
                    t.date,
                    t.symbol,
                    t.side,
                    t.quantity,
                    t.entryPrice,
                    t.exitPrice || '',
                    t.pnl,
                    t.pnlPercent,
                    t.status,
                    t.strategy
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trades_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Initialize
        loadTrades();
        
        // Refresh every 5 seconds
        setInterval(loadTrades, 5000);
    </script>
</body>
</html>